(function(R,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(R=typeof globalThis<"u"?globalThis:R||self,o(R.Vue3ExcelTable={},R.Vue))})(this,(function(R,o){"use strict";const de=new Set(["1","true","TRUE","yes","YES","y","Y","x","X"]),fe=new Set(["0","false","FALSE","no","NO","n","N","",null,void 0]),pe={allowAddEmptyRow:!0,dropdownPasteMode:"both",undoLimit:200,keyFields:[]},S={EDIT:"edit",PASTE:"paste",FILL:"fill",PROGRAMMATIC:"programmatic",UNDO:"undo"};function he(d){return d?d.replace(/\r/g,"").split(`
`).filter((e,r,s)=>!(e===""&&r===s.length-1)).map(e=>e.split("	")):[]}function M(d,e){if(d===null||typeof d>"u")return"";const r=String(d);return e?r:r.toLowerCase()}function ye(d){const e=d.dropdown??{},r=Array.isArray(e.options)?e.options.slice():[],s=e.valueField??"value",l=e.displayField??"label",a=e.keyFields&&e.keyFields.length>0?e.keyFields.slice():[s],p=e.pasteMode??d.pasteMode??"both",u=e.caseSensitive??!1,k=new Map,w=new Map,g=new Map;return r.forEach(f=>{const m=f[s]??f,_=f[l]??f,C=a.map(N=>f[N]).join("||"),x=M(m,u),E=M(_,u);k.has(x)||k.set(x,f),w.has(E)||w.set(E,f),g.set(C,f)}),{options:r,valueField:s,displayField:l,keyFields:a,pasteMode:p,caseSensitive:u,indexByValue:k,indexByDisplay:w,indexByKey:g}}function q(d,e,r){const s=d._dropdown;if(!s)return null;const{pasteMode:l,caseSensitive:a}=s,p=r??l,u=M(e,a),k=p==="both"?["value","display"]:[p];for(const w of k){if(w==="value"&&s.indexByValue.has(u))return s.indexByValue.get(u);if(w==="display"&&s.indexByDisplay.has(u))return s.indexByDisplay.get(u)}return null}function H(d,e){const r=d._dropdown;if(!r)return e;const s=M(e,r.caseSensitive),l=r.indexByValue.get(s);return l?l[r.displayField]??l:e}function J(d,e){const r=d._dropdown;return!r||!e?null:e[r.valueField]??e}function we(d,e){if(!d._dropdown||e===null||typeof e>"u"||e==="")return e;const s=q(d,e);return s?J(d,s):e}function V(d){if(typeof d>"u"||d===null)return d;if(typeof structuredClone=="function")try{return structuredClone(d)}catch{}return Array.isArray(d)?d.map(e=>V(e)):typeof d=="object"?Object.keys(d).reduce((e,r)=>(e[r]=V(d[r]),e),{}):d}function ge(d,e){return d===e||Number.isNaN(d)&&Number.isNaN(e)?!0:JSON.stringify(d)===JSON.stringify(e)}function Y(d){if(d===null||typeof d>"u"||d==="")return null;if(typeof d=="number")return Number.isNaN(d)?null:d;const e=Number(String(d).replace(/,/g,""));return Number.isNaN(e)?null:e}function ke(d){return typeof d=="boolean"?d:de.has(d)?!0:fe.has(d)?!1:!!d}function me(d){return Array.isArray(d)?d:d===null||typeof d>"u"?[]:[d]}function be(d){return me(d).map(e=>typeof e=="string"?{label:e,href:e}:e&&typeof e=="object"?{label:e.label??e.text??e.href??e.url??"",href:e.href??e.url??"#",target:e.target??"_blank"}:null).filter(Boolean)}function X(d,e){return`${d}:${e}`}function _e(d,e){if(!d.key&&!d.field&&!d.id)throw new Error(`Column at index ${e} must provide a key/field/id`);const r=d.key??d.field??d.id,s={type:"text",editable:!0,filterable:!0,sortable:!0,allowPaste:!0,...d,key:r,index:e};return s.type==="dropdown"&&(s._dropdown=ye(s)),s}class T{constructor({columns:e,data:r=[],options:s={}}){if(!Array.isArray(e)||e.length===0)throw new Error("TableModel requires a non-empty columns array");this.options={...pe,...s},this.columns=e.map((l,a)=>_e(l,a)),this.columnIndex=new Map(this.columns.map((l,a)=>[l.key,a])),this.rows=[],this.filters=new Map,this.errors=new Map,this.changeListeners=new Set,this.undoStack=[],this.redoStack=[],this.viewCache=[],this.sortState=null,this._suspendNotifications=!1,this.setData(r,{silent:!0})}getColumn(e){if(!this.columnIndex.has(e))throw new Error(`Unknown column key: ${e}`);return this.columns[this.columnIndex.get(e)]}getColumns(){return this.columns.slice()}getColumnIndex(e){return this.columnIndex.get(e)}getColumnByIndex(e){return this.columns[e]}setData(e,{silent:r=!1}={}){const s=Array.isArray(e)?e.map(l=>this._normalizeRow(l)):[];this.rows=s,this.undoStack=[],this.redoStack=[],this._cleanTrailingEmptyRows(),this._refreshValidations(),this._rebuildView(),r||this._emitChange({type:"data:replace",source:S.PROGRAMMATIC,changes:[],affectedRowIndices:s.map((l,a)=>a),rows:this.getRowsWithIndices(),errors:this.getErrorsGrouped()})}getRawData(){return V(this.rows)}getRowsWithIndices({includeEmptyRow:e=!0}={}){const r=this.viewCache.map(({index:s,row:l,key:a})=>({index:s,key:a,data:V(l)}));if(e&&this.options.allowAddEmptyRow){const s=this._createEmptyRow();r.push({index:this.rows.length,key:`__placeholder-${this.rows.length}`,data:s,isPlaceholder:!0})}return r}getViewRows(e={}){return this.getRowsWithIndices(e)}getSortState(){return this.sortState?{...this.sortState}:null}cycleSort(e){if(!this.columnIndex.has(e))return this.getSortState();const s=this.sortState&&this.sortState.columnKey===e?this.sortState.direction:null;let l=null;return s?s==="asc"?l="desc":l=null:l="asc",this.setSort(e,l)}setSort(e,r){if(r&&!this.columnIndex.has(e))return this.getSortState();const s=r?{columnKey:e,direction:r}:null,l=this.sortState?{...this.sortState}:null;if(!l&&!s||l&&s&&l.columnKey===s.columnKey&&l.direction===s.direction)return this.getSortState();if(s){if(this.getColumn(s.columnKey).sortable===!1)return this.getSortState();this.sortState=s}else this.sortState=null;return this._rebuildView(),this._emitChange({type:"sort",source:S.PROGRAMMATIC,changes:[],affectedRowIndices:this.viewCache.map(({index:a})=>a),rows:this.getRowsWithIndices(),errors:this.getErrorsGrouped(),sortState:this.getSortState()}),this.getSortState()}getRow(e){return V(this.rows[e])}getRowCount(){return this.rows.length}setFilter(e,r){r===null||typeof r>"u"||typeof r=="object"&&Object.keys(r).length===0?this.filters.delete(e):this.filters.set(e,r),this._rebuildView(),this._emitChange({type:"filter",source:S.PROGRAMMATIC,changes:[],affectedRowIndices:this.viewCache.map(({index:s})=>s),rows:this.getRowsWithIndices(),errors:this.getErrorsGrouped()})}clearFilters(){this.filters.clear(),this._rebuildView()}setCell(e,r,s,{source:l=S.EDIT}={}){return this._applyChangeSet([{rowIndex:e,columnKey:r,value:s}],{source:l,type:"cell"})}bulkUpdate(e,{source:r=S.EDIT,type:s="bulk"}={}){return this._applyChangeSet(e,{source:r,type:s})}paste(e,r,s,{source:l=S.PASTE}={}){const a=he(s);if(a.length===0)return null;const p=this.columnIndex.get(r);if(typeof p>"u")throw new Error(`Unknown column key ${r}`);const u=[];return a.forEach((k,w)=>{k.forEach((g,f)=>{const m=this.columns[p+f];!m||m.allowPaste===!1||u.push({rowIndex:e+w,columnKey:m.key,value:m.type==="dropdown"?this._resolveDropdownPasteValue(m,g):g})})}),this._applyChangeSet(u,{source:l,type:"paste"})}fill(e,r,{source:s=S.FILL}={}){if(!e||!r)return null;const{startRow:l,endRow:a,startCol:p,endCol:u}=e,{endRow:k=a,endCol:w=u}=r,g=[];for(let m=l;m<=a;m+=1){const _=[];for(let C=p;C<=u;C+=1){const x=this.columns[C],E=this._ensureRow(m)[x.key];_.push(E)}g.push(_)}const f=[];if(k>a)for(let m=a+1;m<=k;m+=1)g[(m-l)%g.length].forEach((C,x)=>{const E=this.columns[p+x];E&&E.editable&&f.push({rowIndex:m,columnKey:E.key,value:C})});if(w>u)for(let m=u+1;m<=w;m+=1){const _=this.columns[m];if(!(!_||!_.editable))for(let C=l;C<=a;C+=1){const x=g[(C-l)%g.length][(m-p)%g[0].length];f.push({rowIndex:C,columnKey:_.key,value:x})}}return f.length===0?null:this._applyChangeSet(f,{source:s,type:"fill"})}undo(){const e=this.undoStack.pop();if(!e)return null;const r=e.changes.map(({rowIndex:s,columnKey:l,from:a})=>({rowIndex:s,columnKey:l,value:a}));return this.redoStack.push(e),this._applyChangeSet(r,{source:S.UNDO,type:e.type,skipUndo:!0})}redo(){const e=this.redoStack.pop();if(!e)return null;const r=e.changes.map(({rowIndex:s,columnKey:l,to:a})=>({rowIndex:s,columnKey:l,value:a}));return this._applyChangeSet(r,{source:S.EDIT,type:e.type,skipUndo:!1,restoreFromRedo:e})}registerChangeListener(e){return this.changeListeners.add(e),()=>{this.changeListeners.delete(e)}}suspendNotifications(){this._suspendNotifications=!0}resumeNotifications(){this._suspendNotifications=!1}getErrorsGrouped(){const e={};return this.errors.forEach((r,s)=>{e[s]=r.slice()}),e}_resolveDropdownPasteValue(e,r){if(!e._dropdown)return r;const s=q(e,r,e._dropdown.pasteMode);return s?J(e,s):r}_ensureRow(e){for(;e>=this.rows.length;)this.rows.push(this._createEmptyRow());return this.rows[e]}_normalizeRow(e){const r=e??{},s={};return this.columns.forEach(l=>{const a=typeof l.accessor=="function"?l.accessor(r):r[l.key];s[l.key]=this._normalizeValue(l,a)}),s}_normalizeValue(e,r){switch(e.type){case"number":return Y(r);case"checkbox":return ke(r);case"dropdown":return we(e,r);case"links":return be(r);case"button":return r;default:return r}}_applyChangeSet(e,{source:r,type:s,skipUndo:l=!1,restoreFromRedo:a=null}){if(!Array.isArray(e)||e.length===0)return null;const p=[],u=new Set;if(e.forEach(({rowIndex:w,columnKey:g,value:f})=>{if(typeof w!="number"||w<0||!this.columnIndex.has(g))return;const m=this.getColumn(g);if(m.editable===!1)return;const _=this._ensureRow(w),C=this._normalizeValue(m,f),x=_[g];ge(x,C)||(_[g]=C,p.push({rowIndex:w,columnKey:g,oldValue:x,newValue:C}),u.add(w))}),p.length===0)return null;if(l)a&&this.undoStack.push(a);else{const w={type:s,source:r,changes:p.map(({rowIndex:g,columnKey:f,oldValue:m,newValue:_})=>({rowIndex:g,columnKey:f,from:m,to:_}))};this.undoStack.push(w),this.undoStack.length>this.options.undoLimit&&this.undoStack.shift(),this.redoStack=[]}this._cleanTrailingEmptyRows(),this._refreshValidations(Array.from(u)),this._rebuildView();const k={type:s,source:r,changes:p.map(({rowIndex:w,columnKey:g,oldValue:f,newValue:m})=>({rowIndex:w,columnKey:g,oldValue:f,newValue:m})),affectedRowIndices:Array.from(u),rows:Array.from(u).map(w=>({index:w,data:V(this.rows[w])})),errors:this.getErrorsGrouped()};return this._emitChange(k),k}_cleanTrailingEmptyRows(){let e=this.rows.length-1;for(;e>=0&&this._isRowEmpty(this.rows[e]);)e-=1;e<this.rows.length-1&&this.rows.splice(e+1)}_isRowEmpty(e){return e?this.columns.every(r=>{const s=e[r.key];return r.type==="checkbox"?s===!1||s===null||typeof s>"u":r.type==="links"?!s||s.length===0:s===null||typeof s>"u"||s===""}):!0}_createEmptyRow(){const e={};return this.columns.forEach(r=>{const s=typeof r.defaultValue=="function"?r.defaultValue():r.defaultValue??null;e[r.key]=this._normalizeValue(r,s)}),e}_rebuildView(){const e=[];this.rows.forEach((s,l)=>{this._passesFilters(s,l)&&e.push({row:s,index:l})});const r=this._getActiveSortColumn();if(r&&this.sortState){const s=this.sortState.direction==="desc"?-1:1;e.sort((l,a)=>s*this._compareRowsForSort(r,l,a))}this.viewCache=e.map(({row:s,index:l})=>({row:s,index:l,key:this._computeRowKey(s,l)}))}_getActiveSortColumn(){if(!this.sortState)return null;const e=this.columnIndex.get(this.sortState.columnKey);if(typeof e>"u")return this.sortState=null,null;const r=this.columns[e];return!r||r.sortable===!1?(this.sortState=null,null):r}_compareRowsForSort(e,r,s){const l=this._normalizeSortValue(e,r.row[e.key]),a=this._normalizeSortValue(e,s.row[e.key]);if(l===null&&a===null)return r.index-s.index;if(l===null)return 1;if(a===null)return-1;if(typeof l=="number"&&typeof a=="number")return l===a?r.index-s.index:l<a?-1:1;const p=String(l).localeCompare(String(a),void 0,{sensitivity:"base"});return p===0?r.index-s.index:p}_normalizeSortValue(e,r){if(r===null||typeof r>"u")return null;if(e.type==="number"){const s=Y(r);return typeof s=="number"?s:null}if(e.type==="checkbox")return r?1:0;if(e.type==="dropdown"){const s=H(e,r);return typeof s=="string"?s.toLowerCase():String(s??"").toLowerCase()}return e.type==="links"?(r??[]).map(s=>s?.label??s?.href??"").join("||").toLowerCase():r instanceof Date?r.getTime():typeof r=="number"?r:String(r).toLowerCase()}_passesFilters(e,r){if(this.filters.size===0)return!0;for(const[s,l]of this.filters.entries()){const a=this.getColumn(s),p=e[a.key];if(l!=null){if(typeof a.filterPredicate=="function"){if(!a.filterPredicate({value:p,row:e,rowIndex:r,filter:l,column:a,data:this.rows}))return!1;continue}if(a.type==="number"){const{min:u,max:k}=l;if(typeof u=="number"&&(p===null||p<u)||typeof k=="number"&&(p===null||p>k))return!1}else{const u=typeof l=="string"?l:l.query;if(u&&u.trim()){const k=u.trim().toLowerCase();if(!(a.type==="dropdown"?String(H(a,p)??"").toLowerCase():String(p??"").toLowerCase()).includes(k))return!1}}}}return!0}_refreshValidations(e){const r=Array.isArray(e)&&e.length>0?e:Array.from({length:this.rows.length},(l,a)=>a);r.forEach(l=>{this.columns.forEach(a=>{const p=X(l,a.key);this.errors.delete(p)})});const s=new Map;this.columns.forEach(l=>{if(!l.unique)return;const a=new Map;this.rows.forEach((p,u)=>{const k=p[l.key],w=k===null||typeof k>"u"?"__EMPTY__":JSON.stringify(k);a.has(w)||a.set(w,[]),a.get(w).push(u)}),s.set(l.key,a)}),r.forEach(l=>{const a=this.rows[l];a&&this.columns.forEach(p=>{const u=X(l,p.key),k=[],w=a[p.key];if(p.type==="number"&&w!==null&&typeof w!="number"&&k.push("Value must be a number"),p.unique){const g=s.get(p.key),f=w===null||typeof w>"u"?"__EMPTY__":JSON.stringify(w);g&&g.get(f)&&g.get(f).length>1&&k.push("Value must be unique in this column")}if(typeof p.validator=="function"){const g=p.validator({value:w,row:a,rowIndex:l,column:p,data:this.rows,getValue:f=>a[f]});typeof g=="string"&&g.trim()?k.push(g):Array.isArray(g)&&g.filter(Boolean).forEach(f=>k.push(f))}k.length>0&&this.errors.set(u,k)})})}_emitChange(e){this._suspendNotifications||this.changeListeners.forEach(r=>r(e))}_computeRowKey(e,r){const s=Array.isArray(this.options.keyFields)?this.options.keyFields:[];return!e||s.length===0?r:s.map(l=>e[l]).map(l=>l===null||typeof l>"u"?"":String(l)).join("||")}}const Ce={class:"excel-table__grid"},Se=["aria-sort"],xe=["tabindex","role","onClick","onKeydown"],Ee={key:0,class:"excel-table__filter"},Re=["placeholder","value","onInput"],Be=["placeholder","value","onInput"],Ve=["placeholder","value","onInput"],De=["data-row-index","data-row-position"],Ae=["onMousedown","onMouseenter","onPaste"],Fe={class:"excel-table__cell-content"},Ie=["checked","onChange","onKeydown"],Me=["value","onChange"],Ne={key:0,value:""},ze=["value"],Le=["value","onInput","onBlur","onKeydown"],ve=["onClick"],Te={key:4,class:"excel-table__links"},Oe=["href","target"],Pe=["value","onInput","onBlur","onKeydown"],$e={key:0,class:"excel-table__cell-errors"},Q={__name:"ExcelTable",props:{columns:{type:Array,required:!0},modelValue:{type:Array,default:()=>[]},options:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({})}},emits:["update:modelValue","change","update:filters","cell-edit","cell-click","button-click"],setup(d,{emit:e}){const r=d,s=e,l=o.ref(null),a=o.reactive({...r.filters}),p=o.reactive({}),u=o.ref(new T({columns:r.columns,data:r.modelValue,options:r.options})),k=o.ref(u.value.getViewRows()),w=o.ref(u.value.getErrorsGrouped()),g=o.ref(u.value.getSortState()),f=o.ref(null),m=o.ref(null),_=o.ref(null),C=o.ref(!1),x=o.ref(!1),E=o.ref(null),N=o.ref(0),D=o.computed(()=>u.value.getColumns()),Z=o.computed(()=>r.options?.frozenColumns??0),O=o.computed(()=>r.options?.freezeHeader!==!1),ee=o.computed(()=>{const t=[];let i=0;return D.value.forEach((n,h)=>{if(h<Z.value){const c=n.width??n.minWidth??150;t[h]=i,i+=c}else t[h]=null}),t});let A=u.value.registerChangeListener(t=>{w.value=t.errors,k.value=u.value.getViewRows(),g.value=u.value.getSortState(),s("change",t),t.type!=="filter"&&t.type!=="sort"&&s("update:modelValue",u.value.getRawData())});function te(t,i){typeof A=="function"&&A(),ue(),u.value=new T({columns:t??r.columns,data:r.modelValue??[],options:i??r.options??{}}),k.value=u.value.getViewRows(),w.value=u.value.getErrorsGrouped(),g.value=u.value.getSortState(),A=u.value.registerChangeListener(n=>{w.value=n.errors,k.value=u.value.getViewRows(),g.value=u.value.getSortState(),s("change",n),n.type!=="filter"&&n.type!=="sort"&&s("update:modelValue",u.value.getRawData())}),P()}function je(t,i){try{return JSON.stringify(t)===JSON.stringify(i)}catch{return!1}}o.watch(()=>r.modelValue,t=>{je(t,u.value.getRawData())||(u.value.setData(t??[],{silent:!0}),k.value=u.value.getViewRows(),w.value=u.value.getErrorsGrouped(),g.value=u.value.getSortState(),ue())},{deep:!0}),o.watch(()=>r.columns,t=>{te(t,r.options)},{deep:!0}),o.watch(()=>r.options,t=>{te(r.columns,t)},{deep:!0}),o.watch(()=>r.filters,()=>{Object.keys(a).forEach(t=>{delete a[t]}),Object.assign(a,r.filters??{}),P()},{deep:!0}),o.onMounted(()=>{P(),window.addEventListener("mouseup",le)}),o.onBeforeUnmount(()=>{typeof A=="function"&&A(),window.removeEventListener("mouseup",le)});function P(){if(!r.filters){u.value.clearFilters();return}Object.entries(r.filters).forEach(([t,i])=>{i&&typeof i=="object"&&("min"in i||"max"in i)?u.value.setFilter(t,{min:i.min!==""?Number(i.min):void 0,max:i.max!==""?Number(i.max):void 0}):u.value.setFilter(t,i)}),k.value=u.value.getViewRows(),g.value=u.value.getSortState()}function $(t){return O.value&&t<Z.value}function Ke(t){const i=D.value[t],n={};if(i.width?(n.width=`${i.width}px`,n.minWidth=`${i.width}px`):i.minWidth&&(n.minWidth=`${i.minWidth}px`),O.value&&$(t)){const h=ee.value[t]??0;n.left=`${h}px`,n.position="sticky",n.zIndex=3}return O.value&&(n.top="0",n.position="sticky",n.zIndex=(n.zIndex??1)+1),n}function Ue(t){const i={},n=D.value[t];if(n.width?(i.width=`${n.width}px`,i.minWidth=`${n.width}px`):n.minWidth&&(i.minWidth=`${n.minWidth}px`),$(t)){const h=ee.value[t]??0;i.left=`${h}px`,i.position="sticky",i.zIndex=2,i.background="var(--excel-table-cell-bg, #fff)"}return i}function ne(t){if(!t||t.sortable===!1)return;const i=u.value.cycleSort(t.key);g.value=i?{...i}:null}function oe(t,i){(t?.key==="Enter"||t?.key===" ")&&(t.preventDefault(),ne(i))}function F(t){return!g.value||g.value.columnKey!==t?null:g.value.direction}function Ge(t){const i=F(t);return i==="asc"?"ascending":i==="desc"?"descending":"none"}function We(t,i){a[t]=i,u.value.setFilter(t,i),s("update:filters",{...a}),k.value=u.value.getViewRows()}function re(t,i,n){a[t]||(a[t]={min:"",max:""}),a[t][i]=n,u.value.setFilter(t,{min:a[t].min!==""?Number(a[t].min):void 0,max:a[t].max!==""?Number(a[t].max):void 0}),s("update:filters",{...a}),k.value=u.value.getViewRows()}function ie(t,i){const n=a[t];return n&&typeof n=="object"?n[i]??"":""}function se(t,i,n){const h=L(t.index,i.key);p[h]=n}function qe(t,i,n){u.value.setCell(t.index,i.key,n,{source:S.EDIT}),s("cell-edit",{rowIndex:t.index,column:i,value:n})}function He(t,i,n){u.value.setCell(t.index,i.key,n,{source:S.EDIT}),s("cell-edit",{rowIndex:t.index,column:i,value:n})}function Je(t,i){const n={rowIndex:t.index,row:t.data,column:i,model:u.value};i.button?.onClick&&i.button.onClick(n),s("button-click",n)}function Ye(t,i){return typeof i.button?.label=="function"?i.button.label(t.data,t.index,i):typeof t.data[i.key]=="string"?t.data[i.key]:i.button?.label??"Action"}function Xe(t){return t.dropdown?.options??[]}function Qe(t,i){const n=t.dropdown?.valueField??"value";return i[n]??i}function Ze(t,i){const n=t.dropdown?.displayField??"label";return i[n]??i}function et(t,i){return(t.dropdown?.keyFields??[t.dropdown?.valueField??"value"]).map(h=>i[h]).join("||")}function j(t,i){const n=`${t}:${i}`;return w.value?.[n]??[]}function tt(t,i,n){const h=rt(t.index,n),c=j(t.index,i.key).length>0;return{"is-selected":h,"has-error":c,"is-placeholder-cell":t.isPlaceholder}}function nt(t,i,n,h,c){if(t.button!==0)return;x.value=!0;const b={rowIndex:i.index,columnIndex:c};m.value=b,f.value=z(b,b),s("cell-click",{rowIndex:i.index,column:n,event:t})}function ot(t,i,n,h,c){C.value?lt(i.index,c):x.value&&t.buttons===1&&m.value&&(f.value=z(m.value,{rowIndex:i.index,columnIndex:c}))}function le(){C.value&&f.value&&_.value&&at(),C.value=!1,x.value=!1,_.value=null}function rt(t,i){return f.value?t>=f.value.startRow&&t<=f.value.endRow&&i>=f.value.startCol&&i<=f.value.endCol:!1}function z(t,i){return{startRow:Math.min(t.rowIndex,i.rowIndex),endRow:Math.max(t.rowIndex,i.rowIndex),startCol:Math.min(t.columnIndex,i.columnIndex),endCol:Math.max(t.columnIndex,i.columnIndex)}}function it(t,i){return f.value?f.value.endRow===t&&f.value.endCol===i:!1}function st(){f.value&&(C.value=!0,_.value={...f.value})}function lt(t,i){if(!f.value)return;const n={...f.value};t>f.value.endRow&&(n.endRow=t),i>f.value.endCol&&(n.endCol=i),_.value=n}function at(){const t=f.value,i=_.value;!t||!i||(u.value.fill(t,i,{source:S.FILL}),f.value=z({rowIndex:t.startRow,columnIndex:t.startCol},{rowIndex:i.endRow,columnIndex:i.endCol}),_.value=null)}function ae(t){if(N.value,!t)return{};const i=K(t.startRow,t.startCol),n=K(t.endRow,t.endCol);if(!i||!n)return{};const h=i.getBoundingClientRect(),c=n.getBoundingClientRect(),b=E.value;if(!b)return{};const y=b.getBoundingClientRect();return y?{top:`${h.top-y.top+b.scrollTop}px`,left:`${h.left-y.left+b.scrollLeft}px`,width:`${c.right-h.left}px`,height:`${c.bottom-h.top}px`}:{}}function K(t,i){const n=E.value?.querySelector(`tbody tr[data-row-index="${t}"]`);return n?n.querySelectorAll("td")[i]??null:null}function U(t,i,n,h,c){if(!t||typeof c!="number")return;const{key:b,shiftKey:y}=t,B=b==="Tab"&&!y,I=b==="Tab"&&y;if(b==="Escape"){t.preventDefault(),wt(i,n);return}let v=0,W=0;if(b==="Enter")v=y?-1:1;else if(b==="ArrowDown")v=1;else if(b==="ArrowUp")v=-1;else if(b==="ArrowRight"||B)W=1;else if(b==="ArrowLeft"||I)W=-1;else return;t.preventDefault(),t.stopPropagation(),G(i,n),ct({fromViewRowIndex:c,fromColumnIndex:h,rowDelta:v,columnDelta:W})}function ct({fromViewRowIndex:t,fromColumnIndex:i,rowDelta:n=0,columnDelta:h=0}){const c=t+n,b=i+h;if(c<0||c>=k.value.length||b<0||b>=D.value.length)return;const y=k.value[c];y&&ut(y.index,b)}function ut(t,i){const n={rowIndex:t,columnIndex:i};m.value=n,f.value=z(n,n),o.nextTick(()=>{const h=K(t,i);if(!h)return;dt(h);const c=ft(h);if(c){c.focus(),typeof c.select=="function"&&c.tagName==="INPUT"&&c.type!=="checkbox"&&c.select();return}h.hasAttribute("tabindex")||h.setAttribute("tabindex","-1"),h.focus()})}function dt(t){if(t)try{t.scrollIntoView({block:"nearest",inline:"nearest"})}catch{}}function ft(t){return t?t.querySelector('input, select, textarea, button, [contenteditable="true"]'):null}function pt(t,i,n){const h=t.clipboardData.getData("text/plain");if(!h)return;t.preventDefault();const c=u.value.paste(i.index,n.key,h,{source:S.PASTE});if(c&&c.changes.length){const b=c.changes.map(I=>I.rowIndex),y=c.changes.map(I=>u.value.getColumnIndex(I.columnKey)),B={startRow:Math.min(...b),endRow:Math.max(...b),startCol:Math.min(...y),endCol:Math.max(...y)};f.value=B,m.value={rowIndex:B.startRow,columnIndex:B.startCol}}}function ht(t){(t.metaKey||t.ctrlKey)&&(t.key.toLowerCase()==="z"&&(t.preventDefault(),u.value.undo()),(t.key.toLowerCase()==="y"||t.shiftKey&&t.key.toLowerCase()==="z")&&(t.preventDefault(),u.value.redo()))}function yt(){N.value+=1}function L(t,i){return`${t}:${i}`}function ce(t,i){const n=L(t.index,i.key);return Object.prototype.hasOwnProperty.call(p,n)?p[n]:t.data[i.key]??""}function G(t,i){const n=L(t.index,i.key);if(!Object.prototype.hasOwnProperty.call(p,n))return;const h=p[n];delete p[n],u.value.setCell(t.index,i.key,h,{source:S.EDIT}),s("cell-edit",{rowIndex:t.index,column:i,value:h})}function wt(t,i){const n=L(t.index,i.key);Object.prototype.hasOwnProperty.call(p,n)&&delete p[n]}function ue(){Object.keys(p).forEach(t=>{delete p[t]})}return(t,i)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"containerRef",ref:l,class:"excel-table",tabindex:"0",onKeydown:ht},[o.createElementVNode("div",{ref_key:"viewportRef",ref:E,class:"excel-table__viewport",onScroll:yt},[o.createElementVNode("table",Ce,[o.createElementVNode("thead",null,[o.createElementVNode("tr",null,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(D.value,(n,h)=>(o.openBlock(),o.createElementBlock("th",{key:n.key,class:o.normalizeClass(["excel-table__header-cell",{"is-frozen":$(h)}]),style:o.normalizeStyle(Ke(h)),"aria-sort":Ge(n.key)},[o.createElementVNode("div",{class:o.normalizeClass(["excel-table__header-content",{"is-sortable":n.sortable!==!1,"is-sorted":!!F(n.key)}]),tabindex:n.sortable===!1?void 0:0,role:n.sortable===!1?void 0:"button",onClick:()=>ne(n),onKeydown:[o.withKeys(o.withModifiers(c=>oe(c,n),["prevent"]),["enter"]),o.withKeys(o.withModifiers(c=>oe(c,n),["prevent"]),["space"])]},[o.createElementVNode("span",null,o.toDisplayString(n.label??n.title??n.key),1),F(n.key)?(o.openBlock(),o.createElementBlock("span",{key:0,class:o.normalizeClass(["excel-table__sort-indicator",{"is-asc":F(n.key)==="asc","is-desc":F(n.key)==="desc"}]),"aria-hidden":"true"},null,2)):o.createCommentVNode("",!0)],42,xe),n.filterable?(o.openBlock(),o.createElementBlock("div",Ee,[n.type==="number"?(o.openBlock(),o.createElementBlock(o.Fragment,{key:0},[o.createElementVNode("input",{class:"excel-table__filter-input",type:"number",placeholder:n.filterPlaceholderMin??"Min",value:ie(n.key,"min"),onInput:c=>re(n.key,"min",c.target.value)},null,40,Re),o.createElementVNode("input",{class:"excel-table__filter-input",type:"number",placeholder:n.filterPlaceholderMax??"Max",value:ie(n.key,"max"),onInput:c=>re(n.key,"max",c.target.value)},null,40,Be)],64)):(o.openBlock(),o.createElementBlock("input",{key:1,class:"excel-table__filter-input",type:"text",placeholder:n.filterPlaceholder??"Filter",value:a[n.key]??"",onInput:c=>We(n.key,c.target.value)},null,40,Ve))])):o.createCommentVNode("",!0)],14,Se))),128))])]),o.createElementVNode("tbody",null,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(k.value,(n,h)=>(o.openBlock(),o.createElementBlock("tr",{key:n.key??n.index,"data-row-index":n.index,"data-row-position":h,class:o.normalizeClass({"is-placeholder":n.isPlaceholder})},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(D.value,(c,b)=>(o.openBlock(),o.createElementBlock("td",{key:c.key,class:o.normalizeClass(["excel-table__cell",tt(n,c,b)]),style:o.normalizeStyle(Ue(b)),onMousedown:y=>nt(y,n,c,h,b),onMouseenter:y=>ot(y,n,c,h,b),onPaste:o.withModifiers(y=>pt(y,n,c),["prevent"])},[o.createElementVNode("div",Fe,[c.type==="checkbox"?(o.openBlock(),o.createElementBlock("input",{key:0,type:"checkbox",checked:!!n.data[c.key],onChange:y=>qe(n,c,y.target.checked),onKeydown:y=>U(y,n.index,b,h)},null,40,Ie)):c.type==="dropdown"?(o.openBlock(),o.createElementBlock("select",{key:1,class:"excel-table__input",value:n.data[c.key]??"",onChange:y=>He(n,c,y.target.value)},[c.dropdown?.allowEmpty?(o.openBlock(),o.createElementBlock("option",Ne,o.toDisplayString(c.dropdown.emptyLabel??"Selectâ€¦"),1)):o.createCommentVNode("",!0),(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(Xe(c),y=>(o.openBlock(),o.createElementBlock("option",{key:et(c,y),value:Qe(c,y)},o.toDisplayString(Ze(c,y)),9,ze))),128))],40,Me)):c.type==="number"?(o.openBlock(),o.createElementBlock("input",{key:2,class:"excel-table__input",type:"number",value:ce(n,c),onInput:y=>se(n,c,y.target.value),onBlur:()=>G(n,c),onKeydown:y=>U(y,n,c,b,h)},null,40,Le)):c.type==="button"?(o.openBlock(),o.createElementBlock("button",{key:3,type:"button",class:"excel-table__button",onClick:o.withModifiers(()=>Je(n,c),["stop"])},o.toDisplayString(Ye(n,c)),9,ve)):c.type==="links"?(o.openBlock(),o.createElementBlock("div",Te,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(n.data[c.key]??[],y=>(o.openBlock(),o.createElementBlock("a",{key:y.href+y.label,class:"excel-table__link",href:y.href,target:y.target??"_blank",rel:"noopener"},o.toDisplayString(y.label??y.href),9,Oe))),128))])):(o.openBlock(),o.createElementBlock("input",{key:5,class:"excel-table__input",type:"text",value:ce(n,c),onInput:y=>se(n,c,y.target.value),onBlur:()=>G(n,c),onKeydown:y=>U(y,n,c,b,h)},null,40,Pe)),f.value&&it(n.index,b)?(o.openBlock(),o.createElementBlock("span",{key:6,class:"excel-table__fill-handle",onMousedown:o.withModifiers(st,["stop"])},null,32)):o.createCommentVNode("",!0)]),j(n.index,c.key).length?(o.openBlock(),o.createElementBlock("div",$e,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(j(n.index,c.key),(y,B)=>(o.openBlock(),o.createElementBlock("span",{key:`${c.key}-error-${B}`},o.toDisplayString(y),1))),128))])):o.createCommentVNode("",!0)],46,Ae))),128))],10,De))),128))])]),_.value?(o.openBlock(),o.createElementBlock("div",{key:0,class:"excel-table__fill-preview",style:o.normalizeStyle(ae(_.value))},null,4)):o.createCommentVNode("",!0),f.value?(o.openBlock(),o.createElementBlock("div",{key:1,class:"excel-table__selection",style:o.normalizeStyle(ae(f.value))},null,4)):o.createCommentVNode("",!0)],544)],544))}};R.CHANGE_SOURCES=S,R.ExcelTable=Q,R.TableModel=T,R.default=Q,Object.defineProperties(R,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
